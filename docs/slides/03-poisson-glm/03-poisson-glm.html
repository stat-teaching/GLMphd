<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/jquery-3.6.3/jquery-3.6.3.min.js"></script>
<script src="../../site_libs/quarto-contrib/code-fullscreen-1.0.0/code-fullscreen.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/code-fullscreen-1.0.0/code-fullscreen.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/nutshell-1.0.0/nutshell.min.js"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<meta charset="utf-8">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
<meta name="generator" content="quarto-1.8.21">
<meta name="author" content="Filippo Gambarota">
<title>Generalized Linear Models – Poisson GLM</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
<link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-17444cc896c82453f4d942fa9ebb519e.css">
<link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
<style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center"><h1 class="title">Poisson GLM</h1>
  <p class="subtitle">Psychological Sciences</p>
  <p class="author">Filippo Gambarota</p>
  <p class="institute">University of Padova</p>
  <p class="date"><em>Last modified: 26-01-2025</em></p>
</section><section id="poisson-glm" class="slide level2"><h2>Poisson GLM</h2>
<p>Everything that we discussed for the binomial GLM is also relevant for the Poisson GLM. We are gonna focus on specificity of the Poisson model in particular:</p>
<ul>
<li class="fragment">
<strong>Poisson distribution</strong> and <strong>link function</strong>
</li>
<li class="fragment"><strong>Parameters interpretation</strong></li>
<li class="fragment">
<strong>Overdispersion</strong> causes, consequences and remedies</li>
</ul></section><section><section id="poisson-distribution" class="title-slide slide level1 section center"><h1>Poisson distribution</h1>

</section><section id="poisson-distribution-1" class="slide level2"><h2>Poisson distribution</h2>
<p>The Poisson distribution is defined as:</p>
<p><span class="math display">\[
p(y; \lambda) = \frac{\lambda^y e^{-\lambda}}{y!}
\]</span> Where the mean is <span class="math inline">\(\lambda\)</span> and the variance is <span class="math inline">\(\lambda\)</span></p>
</section><section id="poisson-distribution-2" class="slide level2"><h2>Poisson distribution</h2>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-4-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="poisson-distribution-3" class="slide level2"><h2>Poisson distribution</h2>
<p>As the mean increases also the variance increase and the distributions is approximately normal:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-5-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="poisson-distribution-4" class="slide level2"><h2>Poisson distribution</h2>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-6-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="link-function" class="slide level2"><h2>Link function</h2>
<p>The common (and default in R) link function (<span class="math inline">\(g(\lambda)\)</span>) for the Poisson distribution is the <strong>log</strong> link function and the inverse of link function is the exponential.</p>
<p><span class="math display">\[\begin{align*}
log(\lambda_i) = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \cdots + \beta_px_{ip} \\
\lambda_i = e^{\beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \cdots + \beta_px_{ip}}
\end{align*}\]</span></p>
</section></section><section><section id="parameters-intepretation" class="title-slide slide level1 section center"><h1>Parameters intepretation</h1>

</section><section id="an-example" class="slide level2"><h2>An example…</h2>
<p>Let’s start by a simple example trying to explain the number of errors of math exercises by students (N = 100) as a function of the number of hours of study.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="yqnimxfoot" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yqnimxfoot table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yqnimxfoot thead, #yqnimxfoot tbody, #yqnimxfoot tfoot, #yqnimxfoot tr, #yqnimxfoot td, #yqnimxfoot th {
  border-style: none;
}

#yqnimxfoot p {
  margin: 0;
  padding: 0;
}

#yqnimxfoot .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yqnimxfoot .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yqnimxfoot .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yqnimxfoot .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yqnimxfoot .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yqnimxfoot .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yqnimxfoot .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yqnimxfoot .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yqnimxfoot .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yqnimxfoot .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yqnimxfoot .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yqnimxfoot .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yqnimxfoot .gt_spanner_row {
  border-bottom-style: hidden;
}

#yqnimxfoot .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yqnimxfoot .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yqnimxfoot .gt_from_md > :first-child {
  margin-top: 0;
}

#yqnimxfoot .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yqnimxfoot .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yqnimxfoot .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yqnimxfoot .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yqnimxfoot .gt_row_group_first td {
  border-top-width: 2px;
}

#yqnimxfoot .gt_row_group_first th {
  border-top-width: 2px;
}

#yqnimxfoot .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yqnimxfoot .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yqnimxfoot .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yqnimxfoot .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yqnimxfoot .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yqnimxfoot .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yqnimxfoot .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yqnimxfoot .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yqnimxfoot .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yqnimxfoot .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yqnimxfoot .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yqnimxfoot .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yqnimxfoot .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yqnimxfoot .gt_left {
  text-align: left;
}

#yqnimxfoot .gt_center {
  text-align: center;
}

#yqnimxfoot .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yqnimxfoot .gt_font_normal {
  font-weight: normal;
}

#yqnimxfoot .gt_font_bold {
  font-weight: bold;
}

#yqnimxfoot .gt_font_italic {
  font-style: italic;
}

#yqnimxfoot .gt_super {
  font-size: 65%;
}

#yqnimxfoot .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yqnimxfoot .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yqnimxfoot .gt_indent_1 {
  text-indent: 5px;
}

#yqnimxfoot .gt_indent_2 {
  text-indent: 10px;
}

#yqnimxfoot .gt_indent_3 {
  text-indent: 15px;
}

#yqnimxfoot .gt_indent_4 {
  text-indent: 20px;
}

#yqnimxfoot .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table caption-top" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">id</th>
<th id="studyh" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">studyh</th>
<th id="solved" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">solved</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="id">1</td>
<td class="gt_row gt_center" headers="studyh">14</td>
<td class="gt_row gt_center" headers="solved">15</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">2</td>
<td class="gt_row gt_center" headers="studyh">11</td>
<td class="gt_row gt_center" headers="solved">13</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">3</td>
<td class="gt_row gt_center" headers="studyh">91</td>
<td class="gt_row gt_center" headers="solved">60</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">4</td>
<td class="gt_row gt_center" headers="studyh">55</td>
<td class="gt_row gt_center" headers="solved">36</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">...</td>
<td class="gt_row gt_center" headers="studyh">...</td>
<td class="gt_row gt_center" headers="solved">...</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">97</td>
<td class="gt_row gt_center" headers="studyh">49</td>
<td class="gt_row gt_center" headers="solved">30</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">98</td>
<td class="gt_row gt_center" headers="studyh">3</td>
<td class="gt_row gt_center" headers="solved">6</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">99</td>
<td class="gt_row gt_center" headers="studyh">52</td>
<td class="gt_row gt_center" headers="solved">28</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">100</td>
<td class="gt_row gt_center" headers="studyh">90</td>
<td class="gt_row gt_center" headers="solved">68</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="an-example-1" class="slide level2"><h2>An example…</h2>
<ul>
<li class="fragment">There is a clear non-linear and positive relationship</li>
<li class="fragment">The both the mean and variance increase as a function of the predictor</li>
</ul>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-8-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="model-fitting" class="slide level2"><h2>Model fitting</h2>
<p>We can fit the model using the <code>glm</code> function in R setting the appropriate <strong>random component</strong> (<code>family</code>) and the <strong>link function</strong> (<code>link</code>):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = solved ~ studyh, family = poisson(link = "log"), 
#&gt;     data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)  2.29825    0.04603   49.92   &lt;2e-16 ***
#&gt; studyh       0.02066    0.00065   31.78   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 1226.469  on 99  degrees of freedom
#&gt; Residual deviance:   95.636  on 98  degrees of freedom
#&gt; AIC: 610.72
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section><section id="parameters-intepretation-1" class="slide level2"><h2>Parameters intepretation</h2>
<ul>
<li class="fragment">The <code>(Intercept)</code> <span class="math inline">\(2.298\)</span> is the log of the expected number of solved exercises for a student with 0 hours of studying. Taking the exponential we obtain the estimation on the response scale <span class="math inline">\(9.957\)</span>
</li>
<li class="fragment">the <code>studyh</code> <span class="math inline">\(0.021\)</span> is the increase in the expected increase of (log) solved exercises for a unit increase in hours of studying. Taking the exponential we obtain the ratio of increase of the number of solved exercises <span class="math inline">\(1.021\)</span>
</li>
</ul></section><section id="parameters-intepretation-2" class="slide level2"><h2>Parameters intepretation</h2>
<p>Again, as in the binomial model, the effects are linear on the log scale but non-linear on the response scale.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-11-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="parameters-intepretation-3" class="slide level2"><h2>Parameters intepretation</h2>
<p>The non-linearity can be easily seen using the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>studyh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">linear</span><span class="op">)</span> <span class="co"># same as the beta0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;          2 
#&gt; 0.02065628</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">linear</span><span class="op">)</span> <span class="co"># or predict(..., type = "response")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">nonlinear</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;         2 
#&gt; 0.2554891</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ratio of increase when using the response scale</span></span>
<span><span class="va">nonlinear</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">nonlinear</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;        2 
#&gt; 1.020871</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># equivalent to exp(beta1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   studyh 
#&gt; 1.020871</code></pre>
</div>
</div>
</section><section id="parameters-intepretation---categorical-variable" class="slide level2"><h2>Parameters intepretation - Categorical variable</h2>
<p>Let’s make a similar example with the number of solved exercises comparing students who attended online classes and students attending in person. The <code>class_c</code> is the dummy version of <code>class</code> (0 = online, 1 = inperson).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="ccefcspdhb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ccefcspdhb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ccefcspdhb thead, #ccefcspdhb tbody, #ccefcspdhb tfoot, #ccefcspdhb tr, #ccefcspdhb td, #ccefcspdhb th {
  border-style: none;
}

#ccefcspdhb p {
  margin: 0;
  padding: 0;
}

#ccefcspdhb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ccefcspdhb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ccefcspdhb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ccefcspdhb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ccefcspdhb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ccefcspdhb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ccefcspdhb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ccefcspdhb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ccefcspdhb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ccefcspdhb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ccefcspdhb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ccefcspdhb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ccefcspdhb .gt_spanner_row {
  border-bottom-style: hidden;
}

#ccefcspdhb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ccefcspdhb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ccefcspdhb .gt_from_md > :first-child {
  margin-top: 0;
}

#ccefcspdhb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ccefcspdhb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ccefcspdhb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ccefcspdhb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ccefcspdhb .gt_row_group_first td {
  border-top-width: 2px;
}

#ccefcspdhb .gt_row_group_first th {
  border-top-width: 2px;
}

#ccefcspdhb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ccefcspdhb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ccefcspdhb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ccefcspdhb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ccefcspdhb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ccefcspdhb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ccefcspdhb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ccefcspdhb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ccefcspdhb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ccefcspdhb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ccefcspdhb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ccefcspdhb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ccefcspdhb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ccefcspdhb .gt_left {
  text-align: left;
}

#ccefcspdhb .gt_center {
  text-align: center;
}

#ccefcspdhb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ccefcspdhb .gt_font_normal {
  font-weight: normal;
}

#ccefcspdhb .gt_font_bold {
  font-weight: bold;
}

#ccefcspdhb .gt_font_italic {
  font-style: italic;
}

#ccefcspdhb .gt_super {
  font-size: 65%;
}

#ccefcspdhb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ccefcspdhb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ccefcspdhb .gt_indent_1 {
  text-indent: 5px;
}

#ccefcspdhb .gt_indent_2 {
  text-indent: 10px;
}

#ccefcspdhb .gt_indent_3 {
  text-indent: 15px;
}

#ccefcspdhb .gt_indent_4 {
  text-indent: 20px;
}

#ccefcspdhb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table caption-top" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">id</th>
<th id="class" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">class</th>
<th id="class_c" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">class_c</th>
<th id="solved" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">solved</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="id">1</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="solved">8</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">2</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="solved">12</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">3</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="solved">10</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">4</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="solved">10</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">...</td>
<td class="gt_row gt_center" headers="class">...</td>
<td class="gt_row gt_center" headers="class_c">...</td>
<td class="gt_row gt_center" headers="solved">...</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">97</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="solved">15</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">98</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="solved">11</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">99</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="solved">9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">100</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="solved">17</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="parameters-intepretation---categorical-variable-1" class="slide level2"><h2>Parameters intepretation - Categorical variable</h2>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-14-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="parameters-intepretation---categorical-variable-2" class="slide level2"><h2>Parameters intepretation - Categorical variable</h2>
<p>R by default set the categorical variables using <strong>dummy-coding</strong>. In this case we set the reference category to <code>online</code>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">class</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = solved ~ class, family = poisson(link = "log"), 
#&gt;     data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)    2.26592    0.04555  49.747  &lt; 2e-16 ***
#&gt; classinperson  0.39574    0.05892   6.717 1.86e-11 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 140.610  on 99  degrees of freedom
#&gt; Residual deviance:  94.609  on 98  degrees of freedom
#&gt; AIC: 525.84
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section><section id="parameters-intepretation---categorical-variable-3" class="slide level2"><h2>Parameters intepretation - Categorical variable</h2>
<ul>
<li class="fragment">Similarly to the previous example, the intercept is the expected number of solved exercises when the <code>class</code> is 0. Thus the expected number of solved exercises for online students.</li>
<li class="fragment">the <code>classinperson</code> is the difference in log solved exercises between online and in person classes. In the response scale is the expected increase in the ratio of solved exercises. People doing in person classes solve 148.55% of the exercises of people doing online classes</li>
</ul>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; (Intercept) (Intercept) 
#&gt;    2.265921    9.640000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"classinperson"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"classinperson"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; classinperson classinperson 
#&gt;     0.3957361     1.4854772</code></pre>
</div>
</div>
</div>
</section></section><section><section id="overdispersion" class="title-slide slide level1 section center"><h1>Overdispersion</h1>

</section><section id="overdispersion-1" class="slide level2"><h2>Overdispersion</h2>
<p><strong>Overdispersion</strong> concerns observing a greater variance compared to what would have been expected by the model.</p>
<p>The <strong>overdispersion</strong> <span class="math inline">\(\phi\)</span> can be estimated using Pearson Residuals:</p>
<p><span class="math display">\[\begin{align*}
\hat \phi = \frac{\sum_{i = 1}^n \frac{(y_i - \hat y_i)^2}{\hat y_i}}{n - p - 1}
\end{align*}\]</span></p>
<p>Where the numerator is the sum of squared Pearson residuals, <span class="math inline">\(n\)</span> is the number of observations and <span class="math inline">\(k\)</span> the number of predictors. For standard Binomial and Poisson models <span class="math inline">\(\phi = 1\)</span>.</p>
<!-- ref("Applied Regression Analysis and Generalized Linear Models, Fox (2016)", chapter = "15", page = "432") -->
</section><section id="overdispersion-2" class="slide level2"><h2>Overdispersion</h2>
<p>If the model is correctly specified for binomial and poisson models the ratio is equal to 1, of the ratio is <span class="math inline">\(&gt; 1\)</span> there is evidence for overdispersion. In practical terms, if the residual deviance is higher than the residuals degrees of freedom, there is evidence for overdispersion.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># nrow(fit$dat) - length(fit_p$coefficients)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.9465021</code></pre>
</div>
</div>
</section><section id="testing-overdispersion" class="slide level2"><h2>Testing overdispersion</h2>
<p>To formally test for overdispersion i.e.&nbsp;testing if the ratio is significantly different from 1 we can use the <code><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">performance::check_overdispersion()</a></code> function.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # Overdispersion test
#&gt; 
#&gt;        dispersion ratio =  0.947
#&gt;   Pearson's Chi-Squared = 92.757
#&gt;                 p-value =  0.631</code></pre>
</div>
</div>
<!-- ref("Regression and Multilevel Models, (Gelman and Hill, 2007)", 6, "114-115") -->
</section><section id="overdispersion-plot" class="slide level2"><h2>Overdispersion plot</h2>
<p>Pearson residuals are defined as:</p>
<p><span class="math display">\[\begin{align*}
r_p = \frac{y_i - \hat y_i}{\sqrt{V(\hat y_i)}} \\
V(\hat y_i) = \sqrt{\hat y_i}
\end{align*}\]</span></p>
<p>Remember that the mean and the variance are the same in Poisson models. If the model is correct, the standardized residuals should be normally distributed with mean 0 and variance 1.</p>
</section><section id="overdispersion-plot-1" class="slide level2"><h2>Overdispersion plot</h2>

<!-- ref("Regression and Multilevel Models, (Gelman \\& Hill, 2007)", 6, 114) -->
<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-20-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="variance-mean-relationship" class="slide level2"><h2>Variance-mean relationship</h2>
<p>The overdispersion can be expressed also in terms of variance-mean ratio. In fact, when the ratio is 1, there is no evidence of overdispersion.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-21-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section><section id="causes-of-overdispersion" class="slide level2"><h2>Causes of overdispersion</h2>
<p>There could be multiple causes for overdispersion:</p>
<ul>
<li class="fragment">the <strong>phenomenon itself</strong> cannot be modelled with a Poisson distribution</li>
<li class="fragment">
<strong>outliers or anomalous obervations</strong> that increases the observed variance</li>
<li class="fragment">
<strong>missing important variables</strong> in the model</li>
</ul></section><section id="outliers-or-anomalous-data" class="slide level2"><h2>Outliers or anomalous data</h2>
<p>This (simulated) dataset contains <span class="math inline">\(n = 30\)</span> observations coming from a poisson model in the form <span class="math inline">\(y = 1 + 2x\)</span> and <span class="math inline">\(n = 7\)</span> observations coming from a model <span class="math inline">\(y = 1 + 10x\)</span>.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-22-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="outliers-or-anomalous-data-1" class="slide level2"><h2>Outliers or anomalous data</h2>
<p>Clearly the sum of squared pearson residuals is inflated by these values producing more variance compared to what should be expected.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">datout</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">datout</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="co"># mean and variance should be similar</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     mean      var 
#&gt; 2.756757 6.689189</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # Overdispersion test
#&gt; 
#&gt;        dispersion ratio =  1.515
#&gt;   Pearson's Chi-Squared = 53.019
#&gt;                 p-value =  0.026</code></pre>
</div>
</div>
</section><section id="missing-important-variables-in-the-model" class="slide level2"><h2>Missing important variables in the model</h2>
<p>Let’s imagine to analyze again the dataset with the number of solved exercises. We have the effect of the <code>studyh</code> variable. In addition we have the effect of the <code>class</code> variable, without interaction.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="hpqpruoaru" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hpqpruoaru table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hpqpruoaru thead, #hpqpruoaru tbody, #hpqpruoaru tfoot, #hpqpruoaru tr, #hpqpruoaru td, #hpqpruoaru th {
  border-style: none;
}

#hpqpruoaru p {
  margin: 0;
  padding: 0;
}

#hpqpruoaru .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hpqpruoaru .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hpqpruoaru .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hpqpruoaru .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hpqpruoaru .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hpqpruoaru .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hpqpruoaru .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hpqpruoaru .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hpqpruoaru .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hpqpruoaru .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hpqpruoaru .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hpqpruoaru .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hpqpruoaru .gt_spanner_row {
  border-bottom-style: hidden;
}

#hpqpruoaru .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hpqpruoaru .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hpqpruoaru .gt_from_md > :first-child {
  margin-top: 0;
}

#hpqpruoaru .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hpqpruoaru .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hpqpruoaru .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hpqpruoaru .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hpqpruoaru .gt_row_group_first td {
  border-top-width: 2px;
}

#hpqpruoaru .gt_row_group_first th {
  border-top-width: 2px;
}

#hpqpruoaru .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hpqpruoaru .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hpqpruoaru .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hpqpruoaru .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hpqpruoaru .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hpqpruoaru .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hpqpruoaru .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hpqpruoaru .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hpqpruoaru .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hpqpruoaru .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hpqpruoaru .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hpqpruoaru .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hpqpruoaru .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hpqpruoaru .gt_left {
  text-align: left;
}

#hpqpruoaru .gt_center {
  text-align: center;
}

#hpqpruoaru .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hpqpruoaru .gt_font_normal {
  font-weight: normal;
}

#hpqpruoaru .gt_font_bold {
  font-weight: bold;
}

#hpqpruoaru .gt_font_italic {
  font-style: italic;
}

#hpqpruoaru .gt_super {
  font-size: 65%;
}

#hpqpruoaru .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hpqpruoaru .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hpqpruoaru .gt_indent_1 {
  text-indent: 5px;
}

#hpqpruoaru .gt_indent_2 {
  text-indent: 10px;
}

#hpqpruoaru .gt_indent_3 {
  text-indent: 15px;
}

#hpqpruoaru .gt_indent_4 {
  text-indent: 20px;
}

#hpqpruoaru .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table caption-top" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">id</th>
<th id="class" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">class</th>
<th id="studyh" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">studyh</th>
<th id="class_c" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">class_c</th>
<th id="lp" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">lp</th>
<th id="solved" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">solved</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="id">1</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="studyh">82</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="lp">22.613</td>
<td class="gt_row gt_center" headers="solved">24</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">2</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="studyh">65</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="lp">47.734</td>
<td class="gt_row gt_center" headers="solved">50</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">3</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="studyh">12</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="lp">11.268</td>
<td class="gt_row gt_center" headers="solved">15</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">4</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="studyh">54</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="lp">42.785</td>
<td class="gt_row gt_center" headers="solved">50</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">...</td>
<td class="gt_row gt_center" headers="class">...</td>
<td class="gt_row gt_center" headers="studyh">...</td>
<td class="gt_row gt_center" headers="class_c">...</td>
<td class="gt_row gt_center" headers="lp">...</td>
<td class="gt_row gt_center" headers="solved">...</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">37</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="studyh">85</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="lp">23.298</td>
<td class="gt_row gt_center" headers="solved">35</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">38</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="studyh">55</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="lp">43.213</td>
<td class="gt_row gt_center" headers="solved">43</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">39</td>
<td class="gt_row gt_center" headers="class">online</td>
<td class="gt_row gt_center" headers="studyh">80</td>
<td class="gt_row gt_center" headers="class_c">0</td>
<td class="gt_row gt_center" headers="lp">22.167</td>
<td class="gt_row gt_center" headers="solved">26</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">40</td>
<td class="gt_row gt_center" headers="class">inperson</td>
<td class="gt_row gt_center" headers="studyh">77</td>
<td class="gt_row gt_center" headers="class_c">1</td>
<td class="gt_row gt_center" headers="lp">53.788</td>
<td class="gt_row gt_center" headers="solved">54</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="missing-important-variables-in-the-model-1" class="slide level2"><h2>Missing important variables in the model</h2>
<p>We can also have a look at the data:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-25-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="missing-important-variables-in-the-model-2" class="slide level2"><h2>Missing important variables in the model</h2>
<p>Now let’s fit the model considering only <code>studyh</code> and ignoring the group:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = solved ~ studyh, family = poisson(link = "log"), 
#&gt;     data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept) 2.692791   0.068831   39.12   &lt;2e-16 ***
#&gt; studyh      0.013624   0.001063   12.82   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 417.99  on 39  degrees of freedom
#&gt; Residual deviance: 243.99  on 38  degrees of freedom
#&gt; AIC: 451.39
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section><section id="missing-important-variables-in-the-model-3" class="slide level2"><h2>Missing important variables in the model</h2>
<p>Essentially, we are fitting an average relationship across groups but the model ignore that the two groups differs, thus the observed variance is definitely higher because we need two separate means to explain the <code>class</code> effect.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-27-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="missing-important-variables-in-the-model-4" class="slide level2"><h2>Missing important variables in the model</h2>
<p>By fitting the appropriate model, the overdispersion is no longer a problem:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span> <span class="op">+</span> <span class="va">class</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = solved ~ studyh + class, family = poisson(link = "log"), 
#&gt;     data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)   2.275159   0.078239   29.08   &lt;2e-16 ***
#&gt; studyh        0.010895   0.001068   10.21   &lt;2e-16 ***
#&gt; classinperson 0.907365   0.065373   13.88   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 417.993  on 39  degrees of freedom
#&gt; Residual deviance:  29.022  on 37  degrees of freedom
#&gt; AIC: 238.41
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section><section id="missing-important-variables-in-the-model-5" class="slide level2"><h2>Missing important variables in the model</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # Overdispersion test
#&gt; 
#&gt;        dispersion ratio =   6.115
#&gt;   Pearson's Chi-Squared = 232.369
#&gt;                 p-value = &lt; 0.001</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # Overdispersion test
#&gt; 
#&gt;        dispersion ratio =  0.777
#&gt;   Pearson's Chi-Squared = 28.738
#&gt;                 p-value =  0.832</code></pre>
</div>
</div>
</section><section id="missing-important-variables-in-the-model-6" class="slide level2"><h2>Missing important variables in the model</h2>
<p>Also the residuals plots clearly improved after including all relevant predictors:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-31-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="why-worring-about-overdispersion" class="slide level2"><h2>Why worring about overdispersion?</h2>
<p>Before analyzing the two main strategies to deal with overdispersion, it is important to understand why it is very problematic.</p>
<ul>
<li class="fragment">Despite the estimated parameters (<span class="math inline">\(\beta\)</span>) are not affected by overdispersion, standard errors are underestimated. The underestimation increases as the severity of the overdispersion increases.</li>
<li class="fragment">Underestimated standard errors produces (biased) higher <span class="math inline">\(z\)</span> scores inflating the type-1 error (i.e., lower p values)</li>
</ul></section><section id="why-worring-about-overdispersion-1" class="slide level2"><h2>Why worring about overdispersion?</h2>
<p>The estimated overdispersion of <code>fit</code> is ~ 6.4208936. The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function in R has a <code>dispersion</code> argument to check how model parameters are affected.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">deviance</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">df.residual</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, dispersion <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="co"># the default</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;               Estimate  Std. Error  z value     Pr(&gt;|z|)
#&gt; (Intercept) 2.69279058 0.068830558 39.12202 0.000000e+00
#&gt; studyh      0.01362422 0.001062724 12.82009 1.265575e-37</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, dispersion <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="co"># assuming phi = 2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;               Estimate  Std. Error   z value      Pr(&gt;|z|)
#&gt; (Intercept) 2.69279058 0.097341109 27.663447 1.923115e-168
#&gt; studyh      0.01362422 0.001502919  9.065171  1.244091e-19</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, dispersion <span class="op">=</span> <span class="va">phi</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="co"># the appropriate</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;               Estimate  Std. Error   z value     Pr(&gt;|z|)
#&gt; (Intercept) 2.69279058 0.174413070 15.439156 8.926080e-54
#&gt; studyh      0.01362422 0.002692888  5.059333 4.207258e-07</code></pre>
</div>
</div>
</section><section id="why-worring-about-overdispersion-2" class="slide level2"><h2>Why worring about overdispersion?</h2>
<p>By using multiple values for <span class="math inline">\(\phi\)</span> we can see the impact on the standard error. <span class="math inline">\(\phi = 1\)</span> is what is assumed by the Poisson model.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-33-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section></section><section><section id="dealing-with-overdispersion" class="title-slide slide level1 section center"><h1>Dealing with overdispersion</h1>

</section><section id="dealing-with-overdispersion-1" class="slide level2"><h2>Dealing with overdispersion</h2>
<p>If all the variables are included and there are no outliers, the phenomenon itself contains more variability compared to what predicted by the Poisson. There are two main approaches to deal with the situation:</p>
<ul>
<li class="fragment">
<strong>quasi-poisson</strong> model</li>
<li class="fragment">poisson-gamma model AKA <strong>negative-binomial model</strong>
</li>
<li class="fragment">
<strong>multilevel poisson</strong> model</li>
</ul></section><section id="quasi-poisson-model" class="slide level2"><h2>Quasi-poisson model</h2>
<p>The <strong>quasi-poisson</strong> model is essentially a poisson model that estimate the <span class="math inline">\(\phi\)</span> parameter and adjust the standard errors accordingly. Again, assuming to fit the <code>studyh</code> only model (with overdispersion):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasipoisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = solved ~ studyh, family = quasipoisson(link = "log"), 
#&gt;     data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept) 2.692791   0.170209  15.821  &lt; 2e-16 ***
#&gt; studyh      0.013624   0.002628   5.184 7.46e-06 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for quasipoisson family taken to be 6.115055)
#&gt; 
#&gt;     Null deviance: 417.99  on 39  degrees of freedom
#&gt; Residual deviance: 243.99  on 38  degrees of freedom
#&gt; AIC: NA
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section><section id="quasi-poisson-model-1" class="slide level2"><h2>Quasi-poisson model</h2>
<p>The quasi-poisson model estimates the same parameters (<span class="math inline">\(\beta\)</span>) and adjust standard errors. Notice that using <code>summary(dispersion = )</code> is the same as fitting a quasi-Poisson model and using the estimated <span class="math inline">\(\phi\)</span>.</p>
<p>The quasi-poisson model is useful because it is a very simple way to deal with overdispersion.</p>
<p>The variance (<span class="math inline">\(V(\mu)\)</span>) of the Poisson model is no longer <span class="math inline">\(\mu\)</span> but <span class="math inline">\(V(\mu) = \mu\phi\)</span>. When <span class="math inline">\(\phi\)</span> is close to 1, the quasi-Poisson model reduced to a standard Poisson model</p>
</section><section id="quasi-poisson-model-2" class="slide level2"><h2>Quasi-poisson model</h2>
<p>Here we compare the expected variance (<span class="math inline">\(\pm 2\sqrt{V(y_i)}\)</span>)<sup>1</sup> of the Quasi-Poisson and Poisson models:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-35-1.svg" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>This is just an example that did not take into account the link function (notice that the yellow line goes a little bit under 0)</p></li></ol></aside></section><section id="problems-of-quasi--model" class="slide level2"><h2>Problems of Quasi-* model</h2>
<p>The main problem of quasi-* models is that they are not a specific distribution family and there is not a likelihood function. For this reason, we cannot perform model comparison the standard AIC/BIC. See <span class="citation" data-cites="Ver_Hoef2007-jc">(<a href="#/references" role="doc-biblioref" onclick="">Ver Hoef &amp; Boveng, 2007</a>)</span> for an overview.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
</div>
</section><section id="negative-binomial-model" class="slide level2"><h2>Negative-binomial model</h2>
<p>A negative binomial model is different probability distribution with two parameters: the mean as in standard poisson model and the dispersion parameter. Similarly to the quasi-poisson model it estimates a dispersion parameter.</p>
<p>Practically the negative-binomial model can be considered as a hierarchical model:</p>
<p><span class="math display">\[\begin{align*}
y_i \sim Poisson(\lambda_i) \\
\lambda_i \sim Gamma(\mu, \frac{1}{\theta})
\end{align*}\]</span></p>
<p>In this way, the Gamma distribution regulate the <span class="math inline">\(\lambda\)</span> variability that otherwise is fixed to a single value in the Poisson model.</p>
<!-- ref("Generalized linear models, Dunn (2018)", "10", "400") -->
</section><section id="negative-binomial-model-1" class="slide level2"><h2>Negative-binomial model<sup>1</sup>
</h2>
<p>The Poisson-Gamma mixture can be expressed as:</p>
<p><span class="math display">\[
p(y; \mu, \theta) = \frac{\Gamma(y + \theta)}{\Gamma(\theta)\Gamma(y + 1)}\left(\frac{\mu}{\mu + \theta}\right)^{y} \left(\frac{\theta}{\mu + \theta}\right)^\theta
\]</span></p>
<p>Where <span class="math inline">\(\theta\)</span> is the overdispersion parameter, <span class="math inline">\(\Gamma()\)</span> is the gamma function. The mean is <span class="math inline">\(\mu\)</span> and the variance is <span class="math inline">\(\mu + \frac{\mu^2}{\theta}\)</span>. The <span class="math inline">\(\theta\)</span> is the inverse of the overdispersion in terms that as <span class="math inline">\(1/\theta\)</span> increase the data are more overdispersed. As <span class="math inline">\(1/\theta\)</span> approaches 0, the negative-binomial reduced to a Poisson model.</p>
<!-- ref("Generalized linear models, Dunn (2018)", "10", "400") -->
<aside><ol class="aside-footnotes"><li id="fn2"><p>There are multiple parametrizations of the negative-binomial distribution. The one used by <code>MASS</code> is in terms of poisson-gamma mixture see https://mc-stan.org/docs/2_20/functions-reference/nbalt.html</p></li></ol></aside></section><section id="negative-binomial-model-2" class="slide level2"><h2>Negative-binomial model</h2>
<p>Compared to the Poisson model, the negative binomial allows for overdispersion estimating the parameter <span class="math inline">\(\theta\)</span> and compared to the quasi-poisson model the variance is not a linear increase of the mean (<span class="math inline">\(V(\mu) = \theta\mu\)</span>) but have a quadratic relationship <span class="math inline">\(V(\mu) = \mu + \mu^2/\theta\)</span></p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-37-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-3" class="slide level2"><h2>Negative-binomial model</h2>
<p>We can use the <code>MASS</code> package to implement the negative binomial distribution using the <code><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html">MASS::rnegbin()</a></code>:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-38-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-4" class="slide level2"><h2>Negative-binomial model</h2>
<p>The <span class="math inline">\(\theta\)</span> parameter is the estimated dispersion. To note, is not the same as <span class="math inline">\(\phi\)</span> in the quasi-poisson model. As <span class="math inline">\(\theta\)</span> increase, the overdispersion is reduced and the model is similar to a standard Poisson model.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-39-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-5" class="slide level2"><h2>Negative-binomial model</h2>
<p>For fitting a negative-binomial model we cannot use the <code>glm</code> function but we need to use the <code><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">MASS::glm.nb()</a></code> function. The syntax is almost the same but we do not need to specify the family because this function only fit negative-binomial models. Let’s simulate some data coming from a negative binomial distribution with <span class="math inline">\(\theta = 10\)</span></p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">b0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span><span class="va">n</span>, nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">b0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">b1</span><span class="op">)</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html">rnegbin</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">lp</span>, <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="rhoqkiyghr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rhoqkiyghr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rhoqkiyghr thead, #rhoqkiyghr tbody, #rhoqkiyghr tfoot, #rhoqkiyghr tr, #rhoqkiyghr td, #rhoqkiyghr th {
  border-style: none;
}

#rhoqkiyghr p {
  margin: 0;
  padding: 0;
}

#rhoqkiyghr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rhoqkiyghr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rhoqkiyghr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rhoqkiyghr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rhoqkiyghr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rhoqkiyghr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rhoqkiyghr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rhoqkiyghr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rhoqkiyghr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rhoqkiyghr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rhoqkiyghr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rhoqkiyghr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rhoqkiyghr .gt_spanner_row {
  border-bottom-style: hidden;
}

#rhoqkiyghr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rhoqkiyghr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rhoqkiyghr .gt_from_md > :first-child {
  margin-top: 0;
}

#rhoqkiyghr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rhoqkiyghr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rhoqkiyghr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rhoqkiyghr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rhoqkiyghr .gt_row_group_first td {
  border-top-width: 2px;
}

#rhoqkiyghr .gt_row_group_first th {
  border-top-width: 2px;
}

#rhoqkiyghr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rhoqkiyghr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rhoqkiyghr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rhoqkiyghr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rhoqkiyghr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rhoqkiyghr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rhoqkiyghr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rhoqkiyghr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rhoqkiyghr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rhoqkiyghr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rhoqkiyghr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rhoqkiyghr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rhoqkiyghr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rhoqkiyghr .gt_left {
  text-align: left;
}

#rhoqkiyghr .gt_center {
  text-align: center;
}

#rhoqkiyghr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rhoqkiyghr .gt_font_normal {
  font-weight: normal;
}

#rhoqkiyghr .gt_font_bold {
  font-weight: bold;
}

#rhoqkiyghr .gt_font_italic {
  font-style: italic;
}

#rhoqkiyghr .gt_super {
  font-size: 65%;
}

#rhoqkiyghr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rhoqkiyghr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rhoqkiyghr .gt_indent_1 {
  text-indent: 5px;
}

#rhoqkiyghr .gt_indent_2 {
  text-indent: 10px;
}

#rhoqkiyghr .gt_indent_3 {
  text-indent: 15px;
}

#rhoqkiyghr .gt_indent_4 {
  text-indent: 20px;
}

#rhoqkiyghr .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table caption-top" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">id</th>
<th id="x" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">x</th>
<th id="y" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">y</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="id">1</td>
<td class="gt_row gt_center" headers="x">0.427</td>
<td class="gt_row gt_center" headers="y">11</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">2</td>
<td class="gt_row gt_center" headers="x">0.365</td>
<td class="gt_row gt_center" headers="y">13</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">...</td>
<td class="gt_row gt_center" headers="x">...</td>
<td class="gt_row gt_center" headers="y">...</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="id">99</td>
<td class="gt_row gt_center" headers="x">0.966</td>
<td class="gt_row gt_center" headers="y">41</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="id">100</td>
<td class="gt_row gt_center" headers="x">0.154</td>
<td class="gt_row gt_center" headers="y">12</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="negative-binomial-model-6" class="slide level2"><h2>Negative-binomial model</h2>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-42-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-7" class="slide level2"><h2>Negative-binomial model</h2>
<p>Then we can fit the model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_nb</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_nb</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; MASS::glm.nb(formula = y ~ x, data = dat, init.theta = 11.32327809, 
#&gt;     link = log)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)  2.17693    0.08282   26.28   &lt;2e-16 ***
#&gt; x            1.82119    0.13811   13.19   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for Negative Binomial(11.3233) family taken to be 1)
#&gt; 
#&gt;     Null deviance: 273.823  on 99  degrees of freedom
#&gt; Residual deviance:  98.035  on 98  degrees of freedom
#&gt; AIC: 696.14
#&gt; 
#&gt; Number of Fisher Scoring iterations: 1
#&gt; 
#&gt; 
#&gt;               Theta:  11.32 
#&gt;           Std. Err.:  2.38 
#&gt; 
#&gt;  2 x log-likelihood:  -690.143</code></pre>
</div>
</div>
</section><section id="negative-binomial-model-8" class="slide level2"><h2>Negative-binomial model</h2>
<p>Here we compare the expected variance (<span class="math inline">\(\pm 2\sqrt{V(y_i)}\)</span>) of the Negative binomial and Poisson models:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-44-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-9" class="slide level2"><h2>Negative-binomial model</h2>
<p>Here we compare the expected variance (<span class="math inline">\(\pm 2\sqrt{V(y_i)}\)</span>) of the three models:</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-45-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="negative-binomial-model-10" class="slide level2"><h2>Negative-binomial model</h2>
<p>We can compare the coefficients fitting the Poisson, the Quasi-Poisson and the Negative-binomial model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_qp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasipoisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/compareCoefs.html">compareCoefs</a></span><span class="op">(</span><span class="va">fit_nb</span>, <span class="va">fit_p</span>, <span class="va">fit_qp</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Calls:
#&gt; 1: MASS::glm.nb(formula = y ~ x, data = dat, init.theta = 11.32327809, link 
#&gt;   = log)
#&gt; 2: glm(formula = y ~ x, family = poisson(link = "log"), data = dat)
#&gt; 3: glm(formula = y ~ x, family = quasipoisson(link = "log"), data = dat)
#&gt; 
#&gt;             Model 1 Model 2 Model 3
#&gt; (Intercept)  2.1769  2.2043  2.2043
#&gt; SE           0.0828  0.0534  0.0970
#&gt;                                    
#&gt; x            1.8212  1.7723  1.7723
#&gt; SE           0.1381  0.0802  0.1456
#&gt; </code></pre>
</div>
</div>
</section><section id="negative-binomial-model-nb-vs-quasi-poisson-qp" class="slide level2"><h2>Negative-binomial model (NB) vs Quasi-poisson (QP)</h2>
<ul>
<li class="fragment">The NB has the likelihood function thus AIC, LRT and other likelihood-based metrics works compared to the QP</li>
<li class="fragment">The NB assume a different mean-variance relationship thus estimated coefficients could be different to the P where QP produce the same estimates.</li>
<li class="fragment">Both NB and QP estimate higher standard errors in the presence of overdispersion</li>
<li class="fragment">If there is evidence of overdispersion, the important is to fit a model that take into account it</li>
</ul></section><section id="multilevel-poisson" class="slide level2"><h2>Multilevel Poisson</h2>
<ul>
<li class="fragment">Even if we did not discussed multilevel models, the negative binomial model implicitly introduced the topic.</li>
<li class="fragment">Putting a Gamma distribution on the <span class="math inline">\(\lambda\)</span> parameter allows to introduce more variability than assuming a fixed <span class="math inline">\(\lambda\)</span>.</li>
<li class="fragment">A similar result can be achieved assuming that each observation has a different <span class="math inline">\(\lambda\)</span> i.e.&nbsp;adding a random-effect</li>
</ul></section><section id="multilevel-poisson-1" class="slide level2"><h2>Multilevel Poisson</h2>
<p>In fact, if we think about number of errors (or whatever variable) for each participant, we are implicitly saying that each participant perform multiple “trials”.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 6
#&gt;      id class    studyh class_c    lp solved
#&gt;   &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;
#&gt; 1     1 online       82       0  22.6     24
#&gt; 2     2 inperson     65       1  47.7     50
#&gt; 3     3 online       12       0  11.3     15
#&gt; 4     4 inperson     54       1  42.8     50
#&gt; 5     5 online       18       0  12.0     10
#&gt; 6     6 inperson     64       1  47.3     41</code></pre>
</div>
</div>
<p>Each <code>id</code> performs multiple problems solving a certain number of them (<code>solved</code>). There is an hidden multilevel structure here.</p>
</section><section id="multilevel-poisson-2" class="slide level2"><h2>Multilevel Poisson</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span></span>
<span><span class="va">fit_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_m</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Generalized linear mixed model fit by maximum likelihood (Laplace
#&gt;   Approximation) [glmerMod]
#&gt;  Family: poisson  ( log )
#&gt; Formula: solved ~ studyh + (1 | id)
#&gt;    Data: dat
#&gt; 
#&gt;      AIC      BIC   logLik deviance df.resid 
#&gt;    322.8    327.8   -158.4    316.8       37 
#&gt; 
#&gt; Scaled residuals: 
#&gt;      Min       1Q   Median       3Q      Max 
#&gt; -0.92459 -0.44737  0.02909  0.28948  0.56780 
#&gt; 
#&gt; Random effects:
#&gt;  Groups Name        Variance Std.Dev.
#&gt;  id     (Intercept) 0.1946   0.4411  
#&gt; Number of obs: 40, groups:  id, 40
#&gt; 
#&gt; Fixed effects:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept) 2.609225   0.156018  16.724  &lt; 2e-16 ***
#&gt; studyh      0.013478   0.002701   4.991 6.01e-07 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Correlation of Fixed Effects:
#&gt;        (Intr)
#&gt; studyh -0.869
#&gt; optimizer (Nelder_Mead) convergence code: 0 (OK)
#&gt; Model is nearly unidentifiable: very large eigenvalue
#&gt;  - Rescale variables?</code></pre>
</div>
</div>
</section><section id="multilevel-poisson-3" class="slide level2"><h2>Multilevel Poisson</h2>
<p>Let’s see the overdispersion compared to the non-multilevel poisson and the negative-binomial model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_nb</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">solved</span> <span class="op">~</span> <span class="va">studyh</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit_p</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Overdispersion test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        dispersion ratio =   6.115</span></span>
<span><span class="co">#&gt;   Pearson's Chi-Squared = 232.369</span></span>
<span><span class="co">#&gt;                 p-value = &lt; 0.001</span></span>
<span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit_nb</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Overdispersion test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  dispersion ratio = 0.878</span></span>
<span><span class="co">#&gt;           p-value = 0.856</span></span>
<span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">fit_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Overdispersion test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        dispersion ratio = 0.195</span></span>
<span><span class="co">#&gt;   Pearson's Chi-Squared = 7.228</span></span>
<span><span class="co">#&gt;                 p-value =     1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="simulate-nb-data-extra" class="slide level2"><h2>Simulate NB data <code>#extra</code><sup>1</sup>
</h2>
<p>If you want to try to simulate NB data you can use the <code>MASS::rnegbin(n, mu, theta)</code> function or the <code>rnb(n, mu, vmr)</code> custom function that could be more intuitive because requires <span class="math inline">\(\mu\)</span> (i.e., the mean) and <code>vmr</code> that is the desired variance-mean ratio. Using <code>message = TRUE</code> it will tells the <span class="math inline">\(\theta\)</span> value:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rnb</span><span class="op">(</span><span class="fl">1e5</span>, mu <span class="op">=</span> <span class="fl">10</span>, vmr <span class="op">=</span> <span class="fl">7</span>, message <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; y ~ NegBin(mu = 10, theta = 1.67), var = 70.00, vmr = 7.00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">nprint</span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, vmr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     mu      v    vmr 
#&gt;  9.958 69.569  6.986</code></pre>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn3"><p>Using <code>vmr = 1</code> it will use the <code><a href="https://rdrr.io/r/stats/Poisson.html">rpois()</a></code> function</p></li></ol></aside></section><section id="simulate-nb-data-extra-1" class="slide level2"><h2>Simulate NB data <code>#extra</code>
</h2>
<p>You can also use the <code>theta</code> parameter within the <code>rnb</code> function. As <span class="math inline">\(\theta\)</span> increase the overdispersion is reduced. Thus you can think the inverse of <span class="math inline">\(1/\theta\)</span> as an index of overdispersion.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rnb</span><span class="op">(</span><span class="fl">1e5</span>, mu <span class="op">=</span> <span class="fl">10</span>, theta <span class="op">=</span> <span class="fl">10</span>, message <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rnb</span><span class="op">(</span><span class="fl">1e5</span>, mu <span class="op">=</span> <span class="fl">10</span>, theta <span class="op">=</span> <span class="fl">5</span>, message <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rnb</span><span class="op">(</span><span class="fl">1e5</span>, mu <span class="op">=</span> <span class="fl">10</span>, theta <span class="op">=</span> <span class="fl">1</span>, message <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="deviance-based-pseudo-r2" class="slide level2"><h2>Deviance based pseudo-<span class="math inline">\(R^2\)</span>
</h2>
<p>The Deviance based pseudo-<span class="math inline">\(R^2\)</span> is computed from the ratio between the residual deviance and the null deviance<sup>1</sup>:</p>
<p><span class="math display">\[
R^2 = 1 - \frac{D_{current}}{D_{null}}
\]</span> <!-- ref("Applied Regression Analysis and Generalized Linear Models, Fox (2016)", "14.1", "383") --></p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="va">fit_p</span><span class="op">$</span><span class="va">deviance</span><span class="op">/</span><span class="va">fit_p</span><span class="op">$</span><span class="va">null.deviance</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.4162731</code></pre>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn4"><p>https://en.wikipedia.org/wiki/Pseudo-R-squared</p></li></ol></aside></section><section id="mcfaddens-pseudo-r2" class="slide level2"><h2>McFadden’s pseudo-<span class="math inline">\(R^2\)</span>
</h2>
<p>The McFadden’s pseudo-<span class="math inline">\(R^2\)</span> compute the ratio between the log-likelihood of the intercept-only (i.e., null) model and the current model <span class="citation" data-cites="McFadden1987-qq">(<a href="#/references" role="doc-biblioref" onclick="">McFadden, 1987</a>)</span>:</p>
<p><span class="math display">\[
R^2 = 1 - \frac{\log(\mathcal{L_{current}})}{\log(\mathcal{L_{null}})}
\]</span></p>
<p>There is also the adjusted version that take into account the number of parameters of the model. In R can be computed manually or using the <code><a href="https://easystats.github.io/performance/reference/r2_mcfadden.html">performance::r2_mcfadden()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/r2_mcfadden.html">r2_mcfadden</a></span><span class="op">(</span><span class="va">fit_p</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # R2 for Generalized Linear Regression
#&gt;        R2: 0.280
#&gt;   adj. R2: 0.277</code></pre>
</div>
</div>
</section><section id="nagelkerkes-pseudo-r2" class="slide level2"><h2>Nagelkerke’s pseudo-<span class="math inline">\(R^2\)</span>
</h2>
<p>The Cox and Snell’s <span class="citation" data-cites="Cox1989-ql">(<a href="#/references" role="doc-biblioref" onclick="">Cox &amp; Snell, 1989</a>)</span> <span class="math inline">\(R^2\)</span> is defined as:</p>
<p><span class="math display">\[
R^2 = 1 - \left(\frac{\mathcal{L_{null}}}{\mathcal{L_{current}}}\right)^{\frac{2}{n}}
\]</span></p>
<p>Where Nagelkerke <span class="citation" data-cites="Nagelkerke1991-gr">(<a href="#/references" role="doc-biblioref" onclick="">Nagelkerke, 1991</a>)</span> provide a correction to set the range of values between 0 and 1.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/r2_nagelkerke.html">r2_nagelkerke</a></span><span class="op">(</span><span class="va">fit_p</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Nagelkerke's R2 
#&gt;       0.9871216</code></pre>
</div>
</div>
</section></section><section><section id="extra" class="title-slide slide level1 section center"><h1>Extra</h1>

</section><section id="interaction-poisson-vs-linear" class="slide level2"><h2>Interaction, Poisson vs Linear<sup>1</sup>
</h2>
<p>Let’s simulate a GLM where there is a main effect but no interaction:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span><span class="fl">200</span>, nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>, cx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_data</span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">g_c</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">*</span> <span class="va">g_c</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>              method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-56-1.svg" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn5"><p>Thank to Enrico Toffalini for this great example</p></li></ol></aside></section><section id="interaction-poisson-vs-linear-1" class="slide level2"><h2>Interaction, Poisson vs Linear</h2>
<p>Let’s fit a linear model and the Poisson GLM with the interaction term:</p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-1-1">Gaussian GLM</a></li>
<li><a href="#tabset-1-2">Poisson GLM</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">g</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = y ~ x * g, data = dat)
#&gt; 
#&gt; Residuals:
#&gt;      Min       1Q   Median       3Q      Max 
#&gt; -10.9594  -2.7974  -0.3394   2.4466  14.8487 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  11.0610     0.2941  37.603   &lt;2e-16 ***
#&gt; x             3.9829     0.2979  13.371   &lt;2e-16 ***
#&gt; g2            9.9577     0.4163  23.921   &lt;2e-16 ***
#&gt; x:g2          4.0287     0.4347   9.269   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 4.116 on 396 degrees of freedom
#&gt; Multiple R-squared:  0.7717, Adjusted R-squared:   0.77 
#&gt; F-statistic: 446.3 on 3 and 396 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">g</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glm</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = y ~ x * g, family = poisson(link = "log"), data = dat)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)  2.33573    0.02238 104.350   &lt;2e-16 ***
#&gt; x            0.38286    0.02254  16.986   &lt;2e-16 ***
#&gt; g2           0.64219    0.02765  23.226   &lt;2e-16 ***
#&gt; x:g2         0.02549    0.02850   0.894    0.371    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 1816.48  on 399  degrees of freedom
#&gt; Residual deviance:  385.92  on 396  degrees of freedom
#&gt; AIC: 2157.8
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="interaction-poisson-vs-linear-2" class="slide level2"><h2>Interaction, Poisson vs Linear</h2>
<p>The linear model is estimating a completely misleading interaction due to the mean-variance relationship of the Poisson distribution.</p>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-59-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="576"></section><section id="interaction-poisson-vs-linear-3" class="slide level2"><h2>Interaction, Poisson vs Linear</h2>

<img data-src="03-poisson-glm_files/figure-revealjs/unnamed-chunk-60-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section><section id="for-a-more-extensive-example" class="slide level2"><h2>For a more extensive example…</h2>
<p>In this presentation we showed how serious could be the situation when fitting the wrong distribution and link function and estimating an interaction term.</p>
<p><a href="https://filippogambarota.github.io/files/slides/2024-aip-sviluppo.pdf">https://filippogambarota.github.io/files/slides/2024-aip-sviluppo.pdf</a></p>
</section><section id="references" class="slide level2 smaller scrollable"><h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Cox1989-ql" class="csl-entry" role="listitem">
Cox, D. R., &amp; Snell, E. J. (1989). <em>Analysis of binary data, second edition</em>. CRC Press. <a href="https://play.google.com/store/books/details?id=0R8J71LCLXsC">https://play.google.com/store/books/details?id=0R8J71LCLXsC</a>
</div>
<div id="ref-McFadden1987-qq" class="csl-entry" role="listitem">
McFadden, D. (1987). Regression-based specification tests for the multinomial logit model. <em>Journal of Econometrics</em>, <em>34</em>, 63–82. <a href="https://doi.org/10.1016/0304-4076(87)90067-4">https://doi.org/10.1016/0304-4076(87)90067-4</a>
</div>
<div id="ref-Nagelkerke1991-gr" class="csl-entry" role="listitem">
Nagelkerke, N. J. D. (1991). A note on a general definition of the coefficient of determination. <em>Biometrika</em>, <em>78</em>, 691–692. <a href="https://doi.org/10.1093/biomet/78.3.691">https://doi.org/10.1093/biomet/78.3.691</a>
</div>
<div id="ref-Ver_Hoef2007-jc" class="csl-entry" role="listitem">
Ver Hoef, J. M., &amp; Boveng, P. L. (2007). Quasi-poisson vs. Negative binomial regression: How should we model overdispersed count data? <em>Ecology</em>, <em>88</em>, 2766–2772. <a href="https://doi.org/10.1890/07-0043.1">https://doi.org/10.1890/07-0043.1</a>
</div>
</div>
</section></section><!-- FINAL SLIDE --><!-- END FINAL SLIDE -->
</div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="../../site_libs/revealjs/dist/reveal.js"></script><!-- reveal.js plugins --><script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script><script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script><script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script><script src="../../site_libs/revealjs/plugin/notes/notes.js"></script><script src="../../site_libs/revealjs/plugin/search/search.js"></script><script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script><script src="../../site_libs/revealjs/plugin/math/math.js"></script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script><script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script><script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>


</body></html>